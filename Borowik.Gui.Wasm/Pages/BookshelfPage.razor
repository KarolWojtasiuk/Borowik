@page "/Bookshelf/{bookshelfId:guid}"
@using Borowik.Books.Contracts
@using Borowik.Books.Entities

<BookshelfHeader Bookshelf="_bookshelf"/>
<BooksView Bookshelf="_bookshelf"/>

@code
{
    [Parameter]
    public Guid BookshelfId { get; init; }

    [Inject]
    private IExceptionHandler ExceptionHandler { get; init; } = null!;

    [Inject]
    private IBorowikManager BorowikManager { get; init; } = null!;

    [Inject]
    private ILoadingIndicatorService LoadingIndicatorService { get; init; } = null!;

    private BookshelfWithBooks? _bookshelf;

    protected override async Task OnParametersSetAsync()
    {
        await LoadingIndicatorService.Show();

        var response = await ExceptionHandler.HandleAsync(() =>
            BorowikManager.SendRequestAsync(new GetBookshelfRequest(BookshelfId), CancellationToken.None));

        _bookshelf = response.BookshelfWithBooks;

        await LoadingIndicatorService.Hide();
    }
}